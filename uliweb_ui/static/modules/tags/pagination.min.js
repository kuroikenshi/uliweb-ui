riot.tag2("pagination",'<ul class="pagination"> <li if="{totalMessage}" class="disabled total"><a>{totalMessage}</a></li> <li if="{has_first}" class="first"><a href="#" onclick="{go(1)}"><raw content="{first}"></raw></a></li> <li if="{has_prev}" class="prev"><a href="#" onclick="{go(page-1)}"><raw content="{prev}"></raw></a></li> <li class="{page:true, active:p==page}" each="{p in pages}"><a href="#" onclick="{go(p)}">{p}</a></li> <li if="{has_next}" class="next"><a href="#" onclick="{go(page+1)}"><raw content="{next}"></raw></a></li> <li if="{has_last}" class="last"><a href="#" onclick="{go(totalPages)}"><raw content="{last}"></raw></a></li> <li if="{refresh}" class="refresh"><a href="#" onclick="{go(page)}"><raw content="{refresh}"></raw></a></li> </ul>',"","",function(a){var t=this;this.total=a.total,this.page=a.page||1,this.limit=a.limit||10,this.url=a.url,this.data=a.data,this.limits=a.limits||[10,20,30,40,50],this.size=a.size||10,this.pages=[],this.onpage=a.onpage||function(){return t.data.load(t.get_url(),function(a){return t.total=a.total,a.rows})},this.onpagechanged=a.onpagechanged,this._totalMessage=a.totalMessage||"共 $pages 页 / $records 条记录",this.prev=a.prev||"上一页",this.has_prev=!1,this.next=a.next||"下一页",this.has_next=!1,this.first=a.first||"首页",this.has_first=!1,this.last=a.last||"尾页",this.has_last=!1,this.refresh=a.refresh||"刷新",this.on("update",function(){t.show()}),this.get_url=function(a){return get_url(t.url,{page:a||t.page,limit:t.limit})},this.go=function(a){return f=function(s){t.page=a,t.onpage&&"function"==typeof t.onpage?$.when(t.onpage.call(t,a)).done(function(s){t.show(a),t.onpagechanged&&t.onpagechanged(a)}):t.show()},f},this.show=function(s){t.total=a.total||t.total,t.page=s||t.page,t.totalPages=parseInt(t.total/t.limit),t.total%t.limit>0&&t.totalPages++,t._totalMessage&&(t.totalMessage=t._totalMessage.replace("$pages",t.totalPages),t.totalMessage=t.totalMessage.replace("$records",t.total));var s=t.page,e=t.size/2;t.size%2>0&&(e=(t.size+1)/2);var i=1;s>=1&&s<=t.totalPages&&s>=e&&(i=t.totalPages-s>=e?s-(e-1):Math.max(t.totalPages-t.size+1,1)),t.pages=[];for(var l=i,o=Math.min(i+t.size-1,t.totalPages);l<=o;l++)t.pages.push(l);t.size>1?(t.has_prev=t.prev&&s>1,t.has_next=t.next&&s<t.totalPages,t.has_first=1!==i,t.has_last=t.pages[t.pages.length-1]<t.totalPages):(t.has_prev=!1,t.has_next=!1,t.has_last=!1,t.has_first=!1),t.update()}}),riot.tag2("raw","<span></span>","","",function(a){this.on("update",function(){this.root.innerHTML=a.content})});